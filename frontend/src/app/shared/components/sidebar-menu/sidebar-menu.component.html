<ul class="menu p-0">
    @for (item of menuItems; track item.id) {
      <li class="relative">
        <a
          (click)="onItemClick(item, $event)"
          (mouseenter)="onMouseEnter(item.id, $event)"
          (mouseleave)="onMouseLeave()"
          class="flex items-center gap-3 p-3 rounded-lg transition-colors"
          [ngClass]="{
            'bg-primary text-primary-content': isItemActive(item.id),
'hover:bg-slate-300': !isItemActive(item.id),
            'pl-6': level === 1 && !isCollapsed,
            'pl-9': level === 2 && !isCollapsed,
            'justify-center': isCollapsed
          }">

          <!-- Icono -->
          @if (item.icon) {
            <lucide-icon
              [img]="getIconByName(item.icon)"
              class="w-5 h-5 shrink-0"
              [ngClass]="{
                'text-primary-content/80': isItemActive(item.id),
                'text-base-content/60': !isItemActive(item.id)
              }">
            </lucide-icon>
          }

          <!-- Título y Descripción - solo mostrar si no está colapsado -->
          @if (!isCollapsed) {
            <div class="flex flex-col flex-1 min-w-0">
              <span
                class="font-medium"
                [innerHTML]="hasChildren(item) ? 'Configuración' : (item.title | highlight:searchQuery)">
              </span>
              @if (item.description && !hasChildren(item)) {
                <span
                  class="text-xs break-words max-w-full block"
                  [ngClass]="{
                    'text-primary-content/70': isItemActive(item.id),
                    'text-base-content/60': !isItemActive(item.id)
                  }"
                  [innerHTML]="item.description | highlight:searchQuery">
                </span>
              }
            </div>

            <!-- Flecha para expandir - solo mostrar si no está colapsado -->
            @if (hasChildren(item)) {
              <lucide-icon
                [img]="isItemExpanded(item.id) ? chevronDown : chevronRight"
                class="w-4 h-4 transition-transform"
                [class.rotate-180]="isItemExpanded(item.id)">
              </lucide-icon>
            }
          }
        </a>

        <!-- Submenú recursivo - solo mostrar si no está colapsado -->
        @if (hasChildren(item) && isItemExpanded(item.id) && !isCollapsed) {
          <div class="mt-1">
            <app-sidebar-menu
              [menuItems]="item.children!"
              [level]="level + 1"
              [expandedItems]="expandedItems"
              [activeItem]="activeItem"
              [searchQuery]="searchQuery"
              [isCollapsed]="isCollapsed"
              (itemClick)="itemClick.emit($event)"
              (toggleExpanded)="toggleExpanded.emit($event)"
              (navigate)="navigate.emit($event)">
            </app-sidebar-menu>
          </div>
        }

        <!-- Menú flotante directo y simple -->
        @if (isCollapsed && hasChildren(item) && hoveredItemId === item.id) {
<div
class="absolute left-full top-0 ml-2 rounded-lg shadow-xl z-50 min-w-[200px] bg-slate-200 !bg-slate-200"
            (mouseenter)="onMouseEnter(item.id, $event)"
            (mouseleave)="onMouseLeave()"
            (click)="$event.stopPropagation()"
          >
<div class="py-2 bg-slate-200">
              <!-- Título fijo de Configuración -->
              <div class="px-4 py-2 text-sm font-medium text-base-content/80">Configuración</div>
              <!-- Menú de usuarios con hover sólido -->
              <div class="mt-1 [&_.menu-link:hover]:bg-primary [&_.menu-link:hover]:bg-opacity-20 [&_.menu-link:hover]:text-primary">
                <app-sidebar-menu
                  [menuItems]="item.children!"
                  [level]="1"
                  [expandedItems]="expandedItems"
                  [activeItem]="activeItem"
                  [searchQuery]="searchQuery"
                  [isCollapsed]="false"
                  (itemClick)="itemClick.emit($event)"
                  (toggleExpanded)="toggleExpanded.emit($event)"
                  (navigate)="navigate.emit($event)">
                </app-sidebar-menu>
              </div>
            </div>
          </div>
        }
      </li>
    }
  </ul>

