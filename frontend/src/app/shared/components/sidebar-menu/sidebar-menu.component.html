<ul class="menu p-0">
  @for (item of menuItems; track item.id) {
    <li>
      <a
        (click)="onItemClick(item, $event)"
        class="flex items-center gap-3 p-3 rounded-lg transition-colors"
        [ngClass]="{
          'bg-primary text-primary-content': isItemActive(item.id),
          'hover:bg-base-content/10': !isItemActive(item.id),
          'pl-6': level === 1 && !isCollapsed,
          'pl-9': level === 2 && !isCollapsed,
          'justify-center': isCollapsed
        }">

        <!-- Icono -->
        @if (item.icon) {
          <lucide-icon
            [img]="getIconByName(item.icon)"
            class="w-5 h-5 shrink-0"
            [ngClass]="{
              'text-primary-content/80': isItemActive(item.id),
              'text-base-content/60': !isItemActive(item.id)
            }">
          </lucide-icon>
        }

        <!-- Título y Descripción - solo mostrar si no está colapsado -->
        @if (!isCollapsed) {
          <div class="flex flex-col flex-1 truncate">
            <span
              class="font-medium"
              [innerHTML]="item.title | highlight:searchQuery">
            </span>
            @if (item.description) {
              <span
                class="text-xs"
                [ngClass]="{
                  'text-primary-content/70': isItemActive(item.id),
                  'text-base-content/60': !isItemActive(item.id)
                }"
                [innerHTML]="item.description | highlight:searchQuery">
              </span>
            }
          </div>

          <!-- Flecha para expandir - solo mostrar si no está colapsado -->
          @if (hasChildren(item)) {
            <lucide-icon
              [img]="isItemExpanded(item.id) ? chevronDown : chevronRight"
              class="w-4 h-4 transition-transform"
              [class.rotate-180]="isItemExpanded(item.id)">
            </lucide-icon>
          }
        }
      </a>

      <!-- Submenú recursivo - solo mostrar si no está colapsado -->
      @if (hasChildren(item) && isItemExpanded(item.id) && !isCollapsed) {
        <div class="mt-1">
          <app-sidebar-menu
            [menuItems]="item.children!"
            [level]="level + 1"
            [expandedItems]="expandedItems"
            [activeItem]="activeItem"
            [searchQuery]="searchQuery"
            [isCollapsed]="isCollapsed"
            (itemClick)="itemClick.emit($event)"
            (toggleExpanded)="toggleExpanded.emit($event)"
            (navigate)="navigate.emit($event)">
          </app-sidebar-menu>
        </div>
      }
    </li>
  }
</ul>
